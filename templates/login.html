<!DOCTYPE html>
<html lang="id">
  <head>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='img/logo-head.svg') }}"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Omnimap</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/login.css') }}"
    />
  </head>

  <body>
    <div class="container header-login">
      <!-- Robot kiri -->
      <div class="login-robot left-robot">
        <img
          src="{{ url_for('static', filename='img/robot-2.svg') }}"
          alt="Robot Kiri"
        />
      </div>

      <!-- Konten tengah -->
      <div class="login-content">
        <h1 class="text-white">Selamat Datang!</h1>
        <p>
          Temukan insight kepribadianmu dan lihat rekomendasi kegiatan yang
          paling cocok untukmu.
        </p>
      </div>

      <!-- Robot kanan -->
      <div class="login-robot right-robot">
        <img
          src="{{ url_for('static', filename='img/robot-3.svg') }}"
          alt="Robot Kanan"
        />
      </div>
    </div>

    <div class="login-area align-items-center mx-auto">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-12 col-lg-12">
            <img
              src="{{ url_for('static', filename='img/logo.svg') }}"
              class="img-login"
            />
            <form id="loginForm">
              <div class="mb-3">
                <label for="username" class="form-label"><b>Username</b></label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  name="username"
                  placeholder="Masukkan username Anda"
                  required
                />
              </div>
              <div class="mb-3 password-wrapper">
                <label for="password" class="form-label"><b>Password</b></label>

                <div class="input-icon-wrapper">
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    placeholder="Masukkan password Anda"
                    required
                  />

                  <i
                    class="bi bi-eye-slash toggle-password"
                    id="tooglePassword"
                  ></i>
                </div>

                <small class="text-danger d-none" id="passwordError">
                  Username atau password salah
                </small>
              </div>
              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="rememberme"
                />
                <label class="form-check-label" for="rememberme"
                  >Remember me</label
                >
              </div>
              <button type="submit" class="btn btn-login w-100" id="btn-login">
                Sign in
              </button>

              <!-- Link Dummy Account -->
              <div class="text-center mt-4 mb-3">
                <a href="#" class="dummy-account-link" onclick="event.preventDefault();" data-bs-toggle="modal" data-bs-target="#dummyAccountModal">
                  <b>Lihat Akun Dummy</b>
                </a>
              </div>  

            </form>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="loginSuccessModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4">
          <div class="modal-body">
            <img
              src="{{ url_for('static', filename='img/login_success.svg') }}"
              class="login-success-img"
              alt="Login Success"
            />
            <h5 class="mt-5 mb-2"><b>ðŸŽ‰ Anda Berhasil Login</b></h5>
            <p class="text-muted mb-0">
              Selamat! Anda sudah berhasil login. Nikmati fitur Omnimap sekarang
              juga!
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal Dummy Account -->
    <div class="modal fade" id="dummyAccountModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><b>ðŸ“‹ Daftar Akun Dummy</b></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-muted mb-3">Klik username atau password untuk menyalin</p>
            
            <!-- Mahasiswa Accounts -->
            <h6 class="mb-2"><b>Akun Mahasiswa:</b></h6>
            <div class="table-responsive mb-4">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Password</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td class="copy-text">emibunns</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">aniladwi</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">joshuapinem</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">yasminaarethaya</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">rafiehamizan</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">rayhanaray</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">sitinurhaliza</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">budisantoso</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">dewilestari</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">ahmadfauzi</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">rinawijaya</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">ekoprasetyo</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">linamarlina</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">rudihartono</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">mayasari</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">fajarramadhan</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">indahpermata</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">rizkiananda</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">sariwulandari</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">hendragunawan</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">putrikusuma</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">nadiabintangwijaya</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">irfanekapratama</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">omarcahayamaharani</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">wawankusuma</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">aguswibowo</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">citracahayafirmansyah</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">tonoekapananti</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">vickywijaya</td><td class="copy-text">mahasiswa123</td></tr>
                  <tr><td class="copy-text">omarutami</td><td class="copy-text">mahasiswa123</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Admin Account -->
            <h6 class="mb-2"><b>Akun Admin:</b></h6>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Password</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td class="copy-text">puti</td><td class="copy-text">admin123</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document
        .getElementById("tooglePassword")
        .addEventListener("click", function () {
          const passwordInput = document.getElementById("password");
          const type =
            passwordInput.getAttribute("type") === "password"
              ? "text"
              : "password";
          passwordInput.setAttribute("type", type);
          this.classList.toggle("bi-eye");
          this.classList.toggle("bi-eye-slash");
        });

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          const btnLogin = document.getElementById("btn-login");
          const passwordError = document.getElementById("passwordError");

          passwordError.classList.add("d-none");

          btnLogin.disabled = true;
          btnLogin.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';

          try {
            const response = await fetch("/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            });

            const data = await response.json();

            if (data.success) {
              const modal = new bootstrap.Modal(
                document.getElementById("loginSuccessModal")
              );
              modal.show();

              setTimeout(function () {
                window.location.href = data.redirect || "/dashboard";
              }, 2000);
            } else {
              passwordError.textContent =
                data.message || "Username atau password salah";
              passwordError.classList.remove("d-none");

              btnLogin.disabled = false;
              btnLogin.innerHTML = "Sign in";
            }
          } catch (error) {
            console.error("Error:", error);
            passwordError.textContent = "Terjadi kesalahan. Silakan coba lagi.";
            passwordError.classList.remove("d-none");

            btnLogin.disabled = false;
            btnLogin.innerHTML = "Sign in";
          }
        });
    // Initialize modal dengan backdrop yang bisa diklik untuk close
const dummyModal = document.getElementById('dummyAccountModal');
if (dummyModal) {
  // Pastikan modal bisa di-close dengan klik backdrop
  dummyModal.addEventListener('show.bs.modal', function () {
    const backdrop = document.querySelector('.modal-backdrop');
    if (backdrop) {
      backdrop.style.pointerEvents = 'auto';
    }
  });

  dummyModal.addEventListener('shown.bs.modal', function () {
    // Pastikan modal content bisa diklik
    const modalContent = this.querySelector('.modal-content');
    if (modalContent) {
      modalContent.style.pointerEvents = 'auto';
    }
  });
}

// Copy functionality untuk dummy accounts
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.copy-text').forEach(cell => {
    cell.addEventListener('click', function(e) {
      e.stopPropagation();
      const text = this.textContent.trim();
      
      navigator.clipboard.writeText(text).then(() => {
        // Visual feedback
        const originalBg = this.style.backgroundColor;
        const originalColor = this.style.color;
        
        this.style.backgroundColor = '#4caf50';
        this.style.color = 'white';
        
        setTimeout(() => {
          this.style.backgroundColor = originalBg;
          this.style.color = originalColor;
        }, 300);
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    });
  });
});
    </script>
    
  </body>
</html>