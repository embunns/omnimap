<nav class="top-navbar">
    <i class='bi bi-list toggle-sidebar'></i>
    <div class="navbar-right">
        <i id="theme-toggle" class="bi bi-moon" role="button" title="Toggle theme"></i>
        <i class="bi bi-bell"></i>
        <div class="user-info">
            {% if user.profile_picture %}
            <img src="{{ user.profile_picture }}" alt="Profile">
            {% else %}
            <img src="https://i.pravatar.cc/40" alt="Profile">
            {% endif %}
            <div>
                <strong>{{ user.nama }}</strong>
                <small>Mahasiswa</small>
            </div>
        </div>
    </div>
</nav>
<!-- Minimal dark-mode CSS for basic elements; adjust in static/css/style.css as needed -->
<style>
    .dark-mode body {
        background: #0f1115 !important;
        color: #e6eef8 !important;
    }
    .dark-mode #sidebar { background: #0b0c0f !important; color: #cbd5e1 !important; }
    .dark-mode .top-navbar { background: #0b0c0f !important; color: #dbeafe !important; }
    .dark-mode .feature-card { background: #111214 !important; border-color: #1f2937 !important; }
</style>

<script>
    (function(){
        const toggle = document.getElementById('theme-toggle');
        if(!toggle) return;
        const root = document.documentElement;
        const STORAGE_KEY = 'omnimap-theme';

        function applyTheme(dark){
            if(dark){
                root.classList.add('dark-mode');
                toggle.classList.remove('bi-moon');
                toggle.classList.add('bi-sun');
            } else {
                root.classList.remove('dark-mode');
                toggle.classList.remove('bi-sun');
                toggle.classList.add('bi-moon');
            }
            try{ localStorage.setItem(STORAGE_KEY, dark ? 'dark' : 'light'); }catch(e){}
        }

        // Initialize from saved preference
        try{
            const saved = localStorage.getItem(STORAGE_KEY);
            applyTheme(saved === 'dark');
        }catch(e){ applyTheme(false); }

        toggle.addEventListener('click', function(){
            const isDark = root.classList.contains('dark-mode');
            applyTheme(!isDark);
        });
    })();
</script>